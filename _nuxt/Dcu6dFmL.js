import{C as u,N as A,b as E,Y as L,Z as F,$ as T,X as b,z as _,a0 as C,a1 as W,a2 as k,a3 as z,a4 as D,a5 as $,a6 as N,a7 as x,Q as G,P as Q,a8 as X,D as Y}from"./tRvisQ-T.js";const Z=()=>{const n=u("fb_user",()=>null),r=u("fb_auth_initialized",()=>!1),l=u("fb_auth_loading",()=>!0),{$auth:o,$db:v}=A(),g=()=>{if(r.value)return;const e=F(o,t=>{n.value=t,r.value=!0,l.value=!1},t=>{r.value=!0,l.value=!1});T()?b(()=>{console.log("ðŸ§¹ Auth listener unmounted"),e()}):window.addEventListener("beforeunload",()=>e())};r.value||g();const y=async(e,t,a)=>{try{const i=await x(o,e,t);if(i){n.value=i.user;const w=!a||a.trim()===""?e.split("@")[0]:a.trim();return await G(Q(v,"users",i.user.uid),{id:i.user.uid,email:e,role:"user",full_name:w,username:w,phone:"",avatar_url:"",address:{delivery:"",invoice:""},created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),!0}}catch{return!1}return!1},m=async(e,t)=>{try{const a=await N(o,e,t);if(a)return n.value=a.user,!0}catch{return!1}return!1},S=async()=>{try{return await C(o),n.value=null,!0}catch{return!1}},P=E(()=>n.value!==null),f=E(()=>n.value?.uid??null),c=()=>new Promise(e=>{if(r.value||g(),r.value){e(n.value);return}const t=_(r,a=>{a&&(t(),e(n.value))});setTimeout(()=>{r.value||(t(),e(n.value))},5e3)}),h=async e=>{if(!e)return!1;const a={url:`${window.location.origin}/auth/finish-signup`,handleCodeInApp:!0};return z(o,e,a).then(i=>(window.localStorage.setItem("emailForSignIn",e),console.log("RESULT: ",i),!0)).catch(i=>(console.log("ERROR: ",i),!1)),!1},I=async()=>{if(D(o,window.location.href)){let e=window.localStorage.getItem("emailForSignIn");if(!e)e=window.prompt("Please provide your email for confirmation");else try{let t=await $(o,e,window.location.href);if(t)return n.value=t.user,console.log("RESULT: ",t),!0}catch(t){return console.log("ERROR: ",t),!1}}return!1},U=async()=>{const e=new W;try{let t=await k(o,e);if(t){const i=W.credentialFromResult(t)?.accessToken;return n.value=t.user,!0}}catch(t){return console.log("ERROR: ",t),!1}return!1},R=async e=>{try{return await X(o,e),!0}catch(t){return console.log("ERROR: ",t),!1}return!1};return{user:L(n),initialized:L(r),isLoading:L(l),isAuthenticated:P,userId:f,resetUserPassword:R,registerUser:y,signInUserWithEmailPassword:m,confirmUserWithOTP:I,signInUserWithOTP:h,signInUserWithProvider:U,signOutUser:S,waitForAuth:c}},q=()=>{const{user:n,isLoading:r,isAuthenticated:l,resetUserPassword:o,registerUser:v,signInUserWithEmailPassword:g,signOutUser:y,confirmUserWithOTP:m,signInUserWithOTP:S,signInUserWithProvider:P}=Z(),f=u("authUser",()=>null),c=u("authStatus",()=>!1),h=u("loadingStatus",()=>!1);Y(()=>{c.value=l.value,h.value=r.value,f.value=n.value});async function I(s){c.value=s}async function U(s,d){const p=await g(s,d);console.log(p?"Successfully signed in.....":"Failed to sign in.....")}async function R(s){return await o(s),!1}async function e(){const s=await P();console.log(s?"Successfully signed in.....":"Failed to sign in.....")}async function t(s){const d=await S(s);console.log(d?"Successfully signed in.....":"Failed to sign in.....")}const a=async()=>{const s=await m();return console.log(s?"Successfully signed in.....":"Failed to sign in....."),s};async function i(s,d,p){const O=await v(s,d,p);console.log(O?"Successfully registered.....":"Failed to register.....")}async function w(){const s=await y();console.log(s?"Signed out successfully.....":"Failed to sign out.....")}return{authUser:f,authStatus:c,loadingStatus:h,setAuthStatus:I,handleConfirmationWithOTP:a,handleEmailPasswordReset:R,handleLoginWithPassword:U,handleLoginWithOTP:t,handleLoginWithProvider:e,handleRegistration:i,handleLogout:w}};export{Z as a,q as u};
