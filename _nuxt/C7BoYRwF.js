import{N as W,O as q,P as S,Q as z,R as G,S as H,T as J,M as K,m,b as w}from"./tRvisQ-T.js";import{u as V}from"./Dcu6dFmL.js";const X=()=>{const{$auth:D,$db:g}=W(),{authUser:s}=V();async function d(f){if(!s.value)return console.warn("User not ready yet"),null;const u=[];return(await H(J(g,f))).forEach(y=>{u.push(y.data()),console.log("FB-DATA: ",y.id," => ",y.data())}),u}async function c(f,u){if(!s.value)return console.log("User not found"),null;const v=await G(S(g,f,u));return v.exists()?v.data():null}async function l(f,u,v){if(!s.value){console.log("User not found");return}await z(S(g,f,u),v,{merge:!0})}async function o(f,u){if(!s.value){console.log("User not found");return}await q(S(g,f,u))}return{loadAllData:d,loadData:c,saveData:l,removeData:o}},_=K("booking-admin",()=>{const{loadData:D,saveData:g}=X(),s=m([]),d=m({phone:"",email:"",address:""}),c=m([]),l=m([]),o=m([]),f=m([]),u=m(!1),v=w(()=>s.value.map(e=>e.day)),y=w(()=>s.value.map(e=>({day:e.day,times:[...e.times].sort((t,a)=>t.start.localeCompare(a.start))})));async function O(){if(u.value)return;const e=await D("settings","settings");e&&(c.value=e.categories??[],l.value=e.services??[],o.value=e.calendar??[],d.value=e.contact??d.value,s.value=e.shifts??[]),u.value=!0}async function i(){await g("settings","settings",{categories:c.value,services:l.value,calendar:o.value,contact:d.value,shifts:s.value})}function T(e,t){return e.start<t.end&&t.start<e.end}function b(e){return s.value.find(t=>t.day===e)}function A(e){let t={day:e,times:[]};s.value=s.value.find(a=>a.day===e)?s.value.filter(a=>a.day!==e):[...s.value,t],i()}function C(e,t){let a=!1;return e.forEach(n=>{let r=s.value.find(h=>h.day===n);r||(r={day:n,times:[]},s.value.push(r),a=!0),r.times.some(h=>T(h,t))?a=!1:(r.times.push({...t}),a=!0)}),i(),a}function U(e,t){const a=s.value.find(n=>n.day===e);a&&(a.times=a.times.filter(n=>!(n.start===t.start&&n.end===t.end)),a.times.length===0&&(s.value=s.value.filter(n=>n.day!==e)),i())}function I(e){s.value=s.value.filter(t=>t.day!==e),i()}function k(e,t){d.value[e]=t,i()}function j(e){c.value.push({id:e.replace(/\s+/g,"-").toLowerCase(),name:e,active:!0}),i()}function x(e,t){const a=c.value.find(n=>n.id===e);a&&(Object.assign(a,t),i())}function B(e){c.value=c.value.filter(t=>t.id!==e),l.value=l.value.filter(t=>t.categoryId!==e),i()}function E(e){const t=c.value.find(a=>a.id===e);t&&(t.active=!t.active,i())}function F(e){l.value.push({...e,id:crypto.randomUUID()}),i()}function N(e,t){const a=l.value.find(n=>n.id===e);a&&(Object.assign(a,t),i())}function $(e){l.value=l.value.filter(t=>t.id!==e),i()}function L(e){o.value.some(t=>t.dateISO===e)||(o.value.push({dateISO:e,times:[]}),i())}function M(e){o.value=o.value.filter(t=>t.dateISO!==e),i()}function P(e,t,a=1){const n=o.value.find(r=>r.dateISO===e);n&&(n.times.some(r=>r.time24===t)||(n.times.push({time24:t,capacity:a}),i()))}function Q(e,t,a){const n=o.value.find(p=>p.dateISO===e);if(!n)return;const r=n.times.find(p=>p.time24===t);r&&(Object.assign(r,a),i())}function R(e,t){const a=o.value.find(n=>n.dateISO===e);a&&(a.times=a.times.filter(n=>n.time24!==t),i())}return{shifts:s,contact:d,categories:c,services:l,calendar:o,schedule:f,loaded:u,workingDays:v,shiftsSummary:y,init:O,persist:i,getShiftByDay:b,toggleWorkingShift:A,addTimeToDays:C,removeTime:U,removeShift:I,updateContact:k,addCategory:j,updateCategory:x,deleteCategory:B,toggleCategory:E,addService:F,updateService:N,deleteService:$,addDateSlot:L,deleteDateSlot:M,addTimeSlot:P,updateTimeSlot:Q,deleteTimeSlot:R}},{persist:!0});export{X as a,_ as u};
