import{a as p,u as y}from"./Dcu6dFmL.js";import{N as _,C as t,P as c,W as g,R as v,Q as R,z as b,X as U,b as w,Y as d}from"./tRvisQ-T.js";const P=()=>{const{$auth:f,$db:o}=_(),{user:s}=p(),l=t("fb_role",()=>"user"),a=t("fb_profile",()=>null),u=t("fb_role_loading",()=>!1),n=async()=>{if(!s.value)return l.value="user",u.value=!1,"user";try{u.value=!0;const e=c(o,"users",s.value.uid),r=await v(e);l.value=r.exists()?r.data().role:"user"}catch{l.value="user"}finally{u.value=!1}return l.value},i=async()=>{if(a.value={email:"",role:"user",full_name:"",username:"",phone:"",address:{delivery:"",invoice:""}},s.value)try{const e=c(o,"users",s.value.uid),r=await v(e);r.exists()?a.value=r.data():(a.value={email:s.value.email,role:"user",full_name:"",phone:"",address:{delivery:"",invoice:""}},await R(e,a.value))}catch(e){console.error("Error fetching profile:",e)}return a.value};function m(e,r){return{email:r.email??e.email,role:r.role??e.role,full_name:r.full_name??e.full_name,phone:r.phone??e.phone,address:{delivery:r.address?.delivery??e.address.delivery,invoice:r.address?.invoice??e.address.invoice}}}async function h(e){if(!s.value)return!1;try{const r=c(o,"users",s.value.uid);if(await g(r,{...e}),a.value)return a.value=m(a.value,e),!0}catch{return!1}return!1}return{userProfile:a,userRoleStatus:u,getUserRole:n,getUserProfile:i,updateUserProfile:h}},D=()=>{const{authUser:f}=y(),{getUserRole:o}=P(),s=t("user_role",()=>"user"),l=t("role_loading",()=>!1);let a=null;a=b(f,async n=>{if(n){l.value=!0;const i=await o();s.value=i,l.value=!1}else s.value="user"},{immediate:!0}),U(()=>{a&&a()});const u=w(()=>s.value==="admin");return{role:d(s),isRoleLoading:d(l),isAdmin:u}};export{D as a,P as u};
